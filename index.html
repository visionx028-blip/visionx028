<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<title>College Timetable Generator</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #74ebd5, #ACB6E5);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
  }
  .container {
    background: rgba(255,255,255,0.95);
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    width: 700px;
  }
  h2,h3 {margin-top: 0; color: #333;}
  label {display:block;margin-top:10px;font-size:14px;}
  input, select {
    padding: 6px;
    width: 60%;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin-top: 4px;
    font-size: 13px;
  }
  button {
    margin-top: 12px;
    background: linear-gradient(90deg,#0b63d6,#480cd3);
    border: none;
    color: #fff;
    padding: 8px 12px;
    font-weight: bold;
    border-radius: 3px;
    cursor: pointer;
    font-size: 13px;
    margin-right: 5px;
  }
  button:hover {opacity: 0.9;}
  table {
    width: 95%;
    border-collapse: collapse;
    margin-top: 14px;
    font-size: 13px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
  }
  th {background: #eee;}
  .section {
    border: 1px solid #ddd;
    margin-top: 20px;
    padding: 10px;
    border-radius: 10px;
    background: #fafafa;
  }
  .lunch {background:#ffe0b2;font-weight:bold;}
</style>
</head>
<body>
<div class="container">
  <h2>College Timetable Generator</h2>

  <!-- Department Section -->
  <h3>Add Department</h3>
  <label>Department Name</label>
  <input id="deptName" placeholder="e.g. CSE">
  <label>Working Days</label>
  <input id="days" type="number" min="1" max="7" value="5">
  <label>Periods per Day</label>
  <input id="periods" type="number" min="1" max="8" value="6">
  <label>Lunch Period (e.g. 4 = 4th period is lunch)</label>
  <input id="lunchPeriod" type="number" min="1" max="10" value="4">
  <button onclick="addDepartment()">Add Department</button>

  <!-- Faculty Section -->
  <h3>Add Faculty</h3>
  <label>Select Department</label>
  <select id="deptSelect"></select>
  <label>Year</label>
  <select id="yearSelect">
    <option value="1">1st Year</option>
    <option value="2">2nd Year</option>
    <option value="3">3rd Year</option>
    <option value="4">4th Year</option>
  </select>
  <label>Section</label>
  <select id="sectionSelect">
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="C">C</option>
    <option value="D">D</option>
  </select>
  <label>Faculty Name</label>
  <input id="facultyName" placeholder="Enter name">
  <label>Subject</label>
  <input id="subject" placeholder="Enter subject">
  <label>Workload (Max periods per week)</label>
  <input id="workload" type="number" min="1" max="40" value="6">
  <label>Is Lab?</label>
  <select id="isLab">
    <option value="no">No</option>
    <option value="yes">Yes</option>
  </select>
  <button onclick="addFaculty()">Add Faculty</button>

  <!-- History -->
  <h3>Faculty List</h3>
  <div id="facultyHistory"><i>No faculty added yet</i></div>

  <!-- Generate Buttons -->
  <button onclick="generateAll()">Department Timetables</button>
  <button onclick="generateYearWise()">Year-wise Timetables</button>
  <button onclick="generateSectionWise()">Section-wise Timetables</button>
  <button onclick="generateStaffTables()">Staff Timetables</button>
  <button onclick="clearAll()">Clear All</button>

  <h3>Generated Timetables</h3>
  <div id="output"></div>
</div>

<script>
let departments = [];
let facultyCounter = 1;

// Add Department
function addDepartment() {
  let name = document.getElementById("deptName").value.trim();
  let days = parseInt(document.getElementById("days").value);
  let periods = parseInt(document.getElementById("periods").value);
  let lunch = parseInt(document.getElementById("lunchPeriod").value);
  if (!name || isNaN(days) || isNaN(periods) || isNaN(lunch)) {
    alert("⚠ Please fill department details correctly!");
    return;
  }
  const dept = { name, days, periods, lunch, faculties: [] };
  departments.push(dept);

  let select = document.getElementById("deptSelect");
  let opt = document.createElement("option");
  opt.value = dept.name;
  opt.text = dept.name;
  select.add(opt);

  alert("✅ Department added: " + name);
  document.getElementById("deptName").value = "";
}

// Add Faculty
function addFaculty() {
  let deptName = document.getElementById("deptSelect").value;
  if (!deptName) { alert("Select department!"); return; }
  let dept = departments.find(d => d.name === deptName);
  const faculty = {
    id: "F" + facultyCounter++,
    name: document.getElementById("facultyName").value,
    subject: document.getElementById("subject").value,
    workload: parseInt(document.getElementById("workload").value),
    year: document.getElementById("yearSelect").value,
    section: document.getElementById("sectionSelect").value,
    isLab: document.getElementById("isLab").value === "yes",
    assigned: 0
  };
  if (!faculty.name || !faculty.subject) { alert("Enter faculty name & subject!"); return; }
  dept.faculties.push(faculty);
  renderFacultyHistory();
  document.getElementById("facultyName").value = "";
  document.getElementById("subject").value = "";
  document.getElementById("workload").value = 6;
}

// Faculty History
function renderFacultyHistory() {
  const list = document.getElementById("facultyHistory");
  if (departments.every(d => d.faculties.length === 0)) { list.innerHTML = "<i>No faculty added yet</i>"; return; }
  let html = "";
  departments.forEach(dept => {
    if (dept.faculties.length > 0) {
      html += `<div class="section"><h4>${dept.name} Faculty</h4>`;
      html += "<table><tr><th>ID</th><th>Name</th><th>Subject</th><th>Year</th><th>Section</th><th>Workload</th><th>Lab?</th></tr>";
      dept.faculties.forEach(f => {
        html += `<tr><td>${f.id}</td><td>${f.name}</td><td>${f.subject}</td><td>${f.year}</td><td>${f.section}</td><td>${f.workload}</td><td>${f.isLab?"Yes":"No"}</td></tr>`;
      });
      html += "</table></div>";
    }
  });
  list.innerHTML = html;
}

// Generate Department Timetable
function generateTimetable(dept) {
  const days = dept.days, periods = dept.periods, lunch = dept.lunch;
  dept.faculties.forEach(f => f.assigned = 0);
  let timetable = `<div class="section"><h4>${dept.name} Timetable</h4>`;
  timetable += "<table><tr><th>Day</th>";
  for (let p=1; p<=periods; p++) timetable += "<th>P"+p+"</th>";
  timetable += "</tr>";

  for (let d=1; d<=days; d++) {
    timetable += `<tr><td>Day ${d}</td>`;
    let lastFaculty = null;
    for (let p=1; p<=periods; p++) {
      if (p===lunch) { timetable += `<td class="lunch">LUNCH</td>`; continue; }
      let available = dept.faculties.filter(f=>f.assigned<f.workload);
      if (available.length===0){ timetable += "<td>Free</td>"; continue; }
      let chosen = available[Math.floor(Math.random()*available.length)];
      if (chosen.isLab && p<periods && p+1!==lunch && chosen.assigned+2<=chosen.workload) {
        chosen.assigned+=2;
        timetable+=`<td colspan="2">${chosen.subject}[${chosen.id}]<br>(${chosen.name})<br>Y${chosen.year}-${chosen.section} (LAB)</td>`;
        p++; lastFaculty=chosen; continue;
      }
      if(lastFaculty && chosen.id===lastFaculty.id) chosen=available.find(f=>f.id!==lastFaculty.id)||chosen;
      chosen.assigned++;
      timetable+=`<td>${chosen.subject}[${chosen.id}]<br>(${chosen.name})<br>Y${chosen.year}-${chosen.section}</td>`;
      lastFaculty=chosen;
    }
    timetable+="</tr>";
  }
  timetable+="</table></div>";
  return timetable;
}

// Department Timetables
function generateAll() {
  if(departments.length===0){alert("No departments!"); return;}
  let html="";
  departments.forEach(dept=>{
    if(dept.faculties.length===0){html+=`<div class="section"><h4>${dept.name}-No Faculty Added</h4></div>`;}
    else html+=generateTimetable(dept);
  });
  document.getElementById("output").innerHTML=html;
}

// Year-wise Timetable
function generateYearWise(){
  if(departments.length===0){alert("No data!"); return;}
  let html="<h3>Year-wise Timetables</h3>";
  departments.forEach(dept=>{
    for(let year=1; year<=4; year++){
      html+=`<div class="section"><h4>${dept.name}-Year ${year}</h4>`;
      html+="<table><tr><th>Day</th>";
      for(let p=1;p<=dept.periods;p++) html+="<th>P"+p+"</th>";
      html+="</tr>";
      for(let d=1;d<=dept.days;d++){
        html+=`<tr><td>Day ${d}</td>`;
        for(let p=1;p<=dept.periods;p++){
          if(p===dept.lunch){ html+=`<td class="lunch">LUNCH</td>`; continue;}
          let fac=dept.faculties.find(f=>f.year==year);
          html+=`<td>${fac?fac.subject+" ("+fac.name+")":"Free"}</td>`;
        }
        html+="</tr>";
      }
      html+="</table></div>";
    }
  });
  document.getElementById("output").innerHTML=html;
}

// Section-wise Timetable
function generateSectionWise(){
  if(departments.length===0){alert("No data!"); return;}
  let html="<h3>Section-wise Timetables</h3>";
  departments.forEach(dept=>{
    ["A","B","C","D"].forEach(sec=>{
      html+=`<div class="section"><h4>${dept.name}-Section ${sec}</h4>`;
      html+="<table><tr><th>Day</th>";
      for(let p=1;p<=dept.periods;p++) html+="<th>P"+p+"</th>";
      html+="</tr>";
      for(let d=1;d<=dept.days;d++){
        html+=`<tr><td>Day ${d}</td>`;
        for(let p=1;p<=dept.periods;p++){
          if(p===dept.lunch){ html+=`<td class="lunch">LUNCH</td>`; continue;}
          let fac=dept.faculties.find(f=>f.section==sec);
          html+=`<td>${fac?fac.subject+" ("+fac.name+")":"Free"}</td>`;
        }
        html+="</tr>";
      }
      html+="</table></div>";
    });
  });
  document.getElementById("output").innerHTML=html;
}

// Staff Timetables
function generateStaffTables(){
  if(departments.length===0){alert("No data!"); return;}
  let html="<h3>Staff-wise Timetables</h3>";
  departments.forEach(dept=>{
    dept.faculties.forEach(f=>{
      html+=`<div class="section"><h4>${f.name} (${f.subject}) - ${dept.name}, Y${f.year}-${f.section} [${f.id}]</h4>`;
      html+="<p>Timetable mapping is visible in department/year/section views.</p></div>";
    });
  });
  document.getElementById("output").innerHTML=html;
}

// Clear all
function clearAll(){
  departments=[]; facultyCounter=1;
  document.getElementById("deptSelect").innerHTML="";
  document.getElementById("facultyHistory").innerHTML="<i>No faculty added yet</i>";
  document.getElementById("output").innerHTML="";
  alert("All data cleared");
}
</script>
</body>
</html>
